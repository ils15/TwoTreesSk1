[gcode_macro CHECK_TEMPERATURES]
gcode:
  {% set extruder_temp = printer.extruder.temperature %}
  {% set bed_temp = printer.heater_bed.temperature %}
  {% if extruder_temp < 180 or extruder_temp > 250 %}
    M117 "Temperatura do extrusor fora do intervalo seguro!"
    M112 ; Parada de emergência
  {% endif %}
  {% if bed_temp < 0 or bed_temp > 120 %}
    M117 "Temperatura da cama fora do intervalo seguro!"
    M112 ; Parada de emergência
  {% endif %}
  M117 "Temperaturas OK."

[gcode_macro CHECK_ENDSTOPS]
gcode:
  M117 "Verificando Endstops..."
  M18 ; Desativa os motores
  G4 P500 ; Pausa para estabilidade
  QUERY_ENDSTOPS ; Comando para verificar estado dos endstops

[gcode_macro CHECK_HOMING]
gcode:
  G28 ; Executa homing em todos os eixos
  {% if printer.toolhead.position.x != 0 or printer.toolhead.position.y != 0 or printer.toolhead.position.z != 0 %}
    M117 "Erro no homing! Verifique configuração."
    M112 ; Parada de emergência
  {% else %}
    M117 "Homing OK."
  {% endif %}

[gcode_macro CHECK_BED_MESH]
gcode:
  BED_MESH_PROFILE LOAD=default
  {% if not printer.configfile.settings['bed_mesh'].points %}
    M117 "Erro: Malha da cama não calibrada!"
    M112 ; Parada de emergência
  {% else %}
    M117 "Malha da cama OK."
  {% endif %}

[gcode_macro PRE_PRINT_CHECKS]
gcode:
  CHECK_TEMPERATURES
  CHECK_ENDSTOPS
  CHECK_HOMING
  CHECK_BED_MESH
